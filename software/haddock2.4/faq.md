---
layout: page
tags: [Jekyll, HADDOCK, Bonvin, Docking, Simulation, Molecular Dynamics, Structural Biology, Computational Biology, Modelling, Protein Structure]
modified: 2014-08-08T20:53:07.573882-04:00
comments: false
image:
  feature: pages/banner_software.jpg
---

# <font color="RED">HADDOCK2.4</font> manual

## <font color="RED">F</font>AQ

* * *

We will collect here frequently occurring problems and solutions. The following topics are currently available:

*   [What about missing atoms or point mutations?](#missing)
*   [What about ions?](#ions)
*   [Domain definition for docking](#domain)
*   [Clustering issues](#cluster)
*   [Increasing the number of flexible segments](#segments)
*   [Running in batch mode without a queuing system](#batch)
*   [Running in batch mode using a queuing system](#batchqueue)
*   [Small ligands docking with HADDOCK](#ligand)

* * *

<a name="missing">**<u>What about missing atoms or point mutations?</u>**</a>  

Missing atoms will be automatically generated by HADDOCK when [generating the topologies and PDB files](/software/haddock2.4/docking#topology) of the molecules in the **begin** directory. This is done when running the **_generate_X.inp_** CNS scripts (these are originally based on the **_generate_easy.inp_** script from the [CNS distribution](http://cns.csb.yale.edu)). HADDOCK uses the PDB files defined in the [new.html](/software/haddock2.4/start_new_help) file. In case of missing residues, chain breaks will be introduced.  

When setting up the docking from an ensemble of structures it can happen that single point mutants coordinates files are available. These can be used as well provided you do the following:

*   edit the PDB file and rename the mutated residue to the proper amino acid name
*   keep or rename appropriately the matching side-chain atoms

The missing atoms will be generated automatically. It is important to have at least the backbone atoms defined since their average position will be used as starting point to "grow" the missing atoms. Always check that the sequence of the various PDB files match!  

* * *

<a name="ions">**<u>What about ions?</u>**</a>  

Some proteins contains ions such as for example calcium. Their inclusion might be important for docking purposes, in particular for proper electrostatics! In principle, they should be recognized in the [topology generation step](/software/haddock2.4/docking#topology) provided their name in the PDB file matches the ion names defined in the **ion.top** file in the **toppar** directory. To avoid that a N- or C-terminal patch be applied to them, they should also be defined in the **topallhdg5.3.pep** file (look for the "first IONS" and "last IONS" statements).  

Another problem can occur with ions in torsion angle dynamics since they are unconnected single atoms. In the new HADDOCK 2.X version, for the torsion angle dynamics part of the [docking protocol](/software/haddock2.4/docking) (it1), a covalent bond will be automatically defined to the closest ligand atom (only for cations). This is done in the _covalions.cns_ CNS script in the _**protocols**_ directory; the following cations are currently defined: MG<sup>+2</sup>, CA<sup>+2</sup>, FE<sup>+2</sup>, FE<sup>+3</sup>, NI<sup>+2</sup>, CO<sup>+2</sup>, CO<sup>+3</sup>, CU<sup>+1</sup>, CU<sup>+2</sup> and ZN<sup>+2</sup>. If your system contains other ions add them to the _covalions.cns_ file (they should however be defined in _ion.top_).  

* * *

<a name="domain">**<u>Domain definition for docking</u>**</a>  

In general, it is recommended to remove any part of your system such as flexible linkers that are not involved in the interaction with the partner for docking. Keeping these might give trouble in the sorting of solutions. For example, such a linker can make contacts with the partner molecule, resulting in a lower total energy and, in that way, "bad" solutions could still be kept.  

* * *

<a name="cluster">**<u>Clustering issues</u>**</a>  

When choosing which of the two molecules will be in the first segid (e.g. "A"), it is recommended to choose the largest and/or most rigid one of the two. This should give better clustering results since in the rmsd calculation for clustering ([_rmsd.inp_](/software/haddock2.4/analysis#rmsd) CNS script) the structures are first fitted on the semi-flexible segments of the first molecule and then the rmsds are calculated on the semi-flexible segments of the remaining molecules (defined as "ligand interface RMSD").  

Defining the largest and best defined (most rigid) molecule first should thus result in a better fitting.  
**Note** that this is not an issue if fractions of common contact ([FCC](/software/haddock2.4/analysis#fcc)) clustering is used.

* * *

<a name="segments">**<u>Increasing the number of flexible segments</u>**</a>  

In the current distribution, the number of flexible segment is set to 10 for the semi-flexible interface and 5 for the fully flexible segments. If needed, these numbers can be increased. The only file that you will need to modify is _**run.cns**_.  

As an example, say you wish to increase the number of fully flexible segments for molecule A to 10\. Locate in _**run.cns**_ the section concerning the [fully flexible segments](/software/haddock2.4/run#flex), e.g.:  

<pre style="background-color:#DAE4E7">
{=========== Definition of fully flexible segments ==========}
{* Define the fully flexible segment of each molecule.*}
{* These segments will be allowed to move at all stages of it1 *}

{* Number of fully flexible segments for molecule (protein) A            *}
{* Note that current max is 5 (edit the run.cns to add more segments     *}

{===>} nfle_A=0;

{* Fully flexible segments of molecule (protein) A *}
{+ table: rows=5 "segment 1" "segment 2" "segment 3" "segment 4" "segment 5" cols=2 "Start residue" "End residue" +}

{===>} A_start_fle_1="";
{===>} A_end_fle_1="";
{===>} A_start_fle_2="";
{===>} A_end_fle_2="";
{===>} A_start_fle_3="";
{===>} A_end_fle_3="";
{===>} A_start_fle_4="";
{===>} A_end_fle_4="";
{===>} A_start_fle_5="";
{===>} A_end_fle_5="";
</pre>

Increase the number of rows in the table definition to 10, add the additional row headers and add the additional segment definitions. The result should look like:  

<pre style="background-color:#DAE4E7">

{=========== Definition of fully flexible segments ==========}
{* Define the fully flexible segment of each molecule.*}
{* These segments will be allowed to move at all stages of it1 *}

{* Number of fully flexible segments for molecule (protein) A            *}
{* Note that current max is 5 (edit the run.cns to add more segments     *}

{===>} nfle_A=0;

{* Fully flexible segments of molecule (protein) A *}
{+ table: rows=5 "segment 1" "segment 2" "segment 3" "segment 4" "segment 5" cols=2 "Start residue" "End residue" +}

{===>} A_start_fle_1="";
{===>} A_end_fle_1="";
{===>} A_start_fle_2="";
{===>} A_end_fle_2="";
{===>} A_start_fle_3="";
{===>} A_end_fle_3="";
{===>} A_start_fle_4="";
{===>} A_end_fle_4="";
{===>} A_start_fle_5="";
{===>} A_end_fle_5="";
{===>} A_start_fle_6="";
{===>} A_end_fle_6="";
{===>} A_start_fle_7="";
{===>} A_end_fle_7="";
{===>} A_start_fle_8="";
{===>} A_end_fle_8="";
{===>} A_start_fle_9="";
{===>} A_end_fle_9="";
{===>} A_start_fle_10="";
{===>} A_end_fle_10="";
</pre>

You will also need to add additional lines further down in _**run.cns**_ at the location where the segment definitions are stored in the _toppar_ variable, i.e.:  

<pre style="background-color:#DAE4E7" >
evaluate (&toppar.A_start_fle_1=&A_start_fle_1)
evaluate (&toppar.A_start_fle_2=&A_start_fle_2)
evaluate (&toppar.A_start_fle_3=&A_start_fle_3)
evaluate (&toppar.A_start_fle_4=&A_start_fle_4)
evaluate (&toppar.A_start_fle_5=&A_start_fle_5)
evaluate (&toppar.A_start_fle_6=&A_start_fle_6)
evaluate (&toppar.A_start_fle_7=&A_start_fle_7)
evaluate (&toppar.A_start_fle_8=&A_start_fle_8)
evaluate (&toppar.A_start_fle_9=&A_start_fle_9)
evaluate (&toppar.A_start_fle_10=&A_start_fle_10)
</pre>

Repeat this for protein B is needed or to increase the number of flexible segments for the interface definition.  

* * *

<a name="batch">**<u>Running in batch mode without a queuing system</u>**</a>  

_A contribution from Melissa Stauffer, Vanderbilt University, USA_  

Here is a description of the setup on a Linux cluster that has no queuing system installed. It has a head node/firewall with 16 dual-cpu compute nodes behind it. From the head node, processes can be spawned to the compute nodes using rsh. Authentication to compute nodes is done via the /etc/hosts.equiv mechanism - no prompting for passwords. HADDOCK was setup to use each of the 32 compute-node CPUs by creating a simple csh wrapper script called _"haddock_wrapper"_ that contains two lines like this:  

<pre style="background-color:#DAE4E7">
cd _project_directory_
csh -f $1
</pre>

Then, in the run.cns file, we define our "queues" like:

<pre style="background-color:#DAE4E7">
{===>} queue_1="rsh node1 ~/bin/haddock_wrapper";
{===>} cns_exe_1="cns";
{===>} cpunumber_1=2;

{===>} queue_2="rsh node1 ~/bin/haddock_wrapper";
{===>} cns_exe_2="cns";
{===>} cpunumber_2=2;

...
</pre>

etc - one "queue" for each compute node to be included in this haddock run.  

If rsh is blocked, you can use instead ssh, but for this to work you need to set up ssh such as no password is needed. See for that:  
[http://xeny.net/Passwordless_S_S_H](http://xeny.net/Passwordless_S_S_H)  
(Thanks to Andrea Spitaleri)  

* * *

<a name="batchqueue"> **<u>Running HADDOCK on a cluster using a queuing system (e.g. PBS or Torque)</u>**</a>  

In order to submit to the queuing system we use typically a wrapper script that will add some directives to the job files. Here is one example of such a wrapper script called _ssub_ that would submit to the default queue:  

<pre style="background-color:#DAE4E7">
#!/bin/csh -f
if ($#argv < 1) then
  echo "Usage : ssub jobname"
  exit 1
endif

# check if job exists + make it executable
set jobname=$1
if (! -e $1) then
  echo "job file does not exist"
  exit 1
endif
if (! -x $jobname) chmod +x $jobname

# write temporary pbs script
set pbsjob=$jobname.pbsjob.$
if (! -e $pbsjob) then
  touch $pbsjob
else
  \rm $pbsjob
  touch $pbsjob
endif
set PWD=`pwd`

echo "#PBS -S" $SHELL >> $pbsjob
set outfile=$PWD/$jobname.out.$ >> $pbsjob
echo "#PBS -o $outfile" >> $pbsjob
set errorfile=$PWD/$jobname.err.$ >> $pbsjob
echo "#PBS -e $errorfile" >> $pbsjob
echo "#PBS -m n" >> $pbsjob
echo "cd $PWD" >> $pbsjob
echo "./$jobname" >>$pbsjob

chmod +x $pbsjob
qsub -j eo $pbsjob
rm -rf $pbsjob
exit
</pre>

Change your run.cns script (here we assume _ssub_ is in your path, otherwise give the full path to it):  

<pre style="background-color:#DAE4E7">{===>} queue_1="ssub";
{===>} cns_exe_1="/home/software/software/cns_solve_1.31-UU/intel-x86_64bit-linux/bin/cns";
{===>} cpunumber_1=100;
</pre>

This will cause HADDOCK to submit 100 jobs simultaneously to the batch system. Once a structure comes back the next job will be submitted. You can adapt the wrapper script to submit to specific queues.  

Note that since the rigid-body docking jobs (it0) are usually very fast, it is possible to bundle a number of those into a single job to avoid overloading the batch system. For this edit in your HADDOCK installation the following file: _Haddock/Main/QueueSubmit_concat.py_ and change the value of _jobmax["it0"]_. In the following example, 5 docking jobs would be concatenated into one job for it0:  

<pre style="background-color:#DAE4E7">jobmax["it0"] = 5
jobmax["it1"] = 1
jobmax["water"]= 1
</pre>

* * *

<a name="ligand">**<u>Small ligand docking with HADDOCK</u>**</a>  

It's possible to dock small ligands using HADDOCK but for that topology and parameter files for the ligand should be provided in CNS format. Several sources exist to find such files:

*   the **PRODGR** server maintained by Daan van Aalten at Dundee University: [http://prodrg2.dyndns.org](http://prodrg2.dyndns.org)  
    This server allows you to draw your molecule or paste coordinates and will return topologies and parameter files in various format, including CNS. You should turn on the electrostatic to obtain partial charges. Save the resulting PDB file and the corresponding CNS parameter and topology files to use in HADDOCK.  

    **Important:** The generated parameter file contains a CNS NBONds statement which should be removed prior to use in HADDOCK. Look in the parameter file for:  

    <pre style="background-color:#DAE4E7">     NBONds
           CUTNB=7.0 WMIN=1.5
           REPEL=1.0 REXPONENT=4
           IREXPONENT=1 RCONST=16.0
           TOLERANCE=0.5 NBXMOD=5
           CTONNB=5.5 CTOFNB=6.0
         END
    </pre>

    and remove or comment it out (by adding ! before each line).  

*   the Automated Topology Builder (ATB) and Repository developed in Prof. Alan Mark's group at the University of Queensland in Brisbane: [http://compbio.biosci.uq.edu.au/atb](http://compbio.biosci.uq.edu.au/atb)  
    **Note**: we did not yet test those parameters in HADDOCK.

*   the **HIC-Up** database maintained by Gerard Kleywegt at Uppsalla University: [http://xray.bmc.uu.se/hicup](http://xray.bmc.uu.se/hicup/)  
    One problem with those files for use in docking is that typically all partial charges are set to zero, <u>meaning that the electrostatic interaction energies will thus be zero unless you change the partial charges</u>. Still, the HIC-Up topology and parameter files provide a good starting point.

For docking small ligand with HADDOCK using custom-made topology and parameter files and perform the following steps:

1.  Setup your HADDOCK run in the usual way, i.e. generating the _new.html_ file and running haddock first to generate the run directory structure.

3.  Place your custom topology and parameter files in the _toppar_ directory.

5.  When modifying the docking parameters in _run.cns_, specify the proper topology and parameter files for your ligand. Or alternatively, place the topology and parameter files of your ligand in the _toppar/ligand.top_ and _toppar/ligand.param_ files, respectively.

7.  To avoid that a N- or C-terminal patch be applied to your ligand, add "first IONS" and "last IONS" statements with the name of your ligand in the topallhdg5.3.pep file in the _**toppar**_ directory (look for the "first IONS" and "last IONS" statements)

Also we recommend to set the number of MD steps for the first two parts (rigid-body high temperature dynamic and slow cooling annealing) of the [semi-flexible refinement](/software/haddock2.4/docking#sa) to 0.  

**Important:** When starting a run, always check for error messages in the begin directory in the various generate...out files, especially for your ligand.

* * *
